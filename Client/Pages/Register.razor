@page "/register"
@using System.ComponentModel.DataAnnotations

<PageTitle>Register</PageTitle>

<div class="register-container">
    <EditForm Model="_registerModel" OnValidSubmit="HandleRegister">
        <DataAnnotationsValidator/>
        
        <div class="register-card">
            <h2 class="register-title">Sign up</h2>
            @if (!string.IsNullOrEmpty(_errorMessage))
            {
                <div class="error-alert">@_errorMessage</div>
            }
            
            <div class="form-group">
                <label>Username</label>
                <InputText @bind-Value="_registerModel.Username" class="form-input" placeholder="Enter username"/>
                <ValidationMessage For="() => _registerModel.Username" />
            </div>
            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="_registerModel.Email" class="form-input" placeholder="Enter email"/>
                <ValidationMessage For="() => _registerModel.Email" />
            </div>
            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="_registerModel.Password" class="form-input" placeholder="Enter Password"/>
                <ValidationMessage For="() => _registerModel.Password" />
            </div>
            
            <button type="submit" class="register-button" disabled="@_isLoading">
                @(_isLoading ? "Processing..." : "Register")
            </button>
        </div>
    </EditForm>
</div>

@code {

    private RegisterModel _registerModel = new();
    private string? _errorMessage;
    private bool _isLoading;

    public class RegisterModel
    {
        [Required(ErrorMessage = "Username is required")]
        public string? Username { get; set; }
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email format")]
        public string? Email { get; set; }

        [Required(ErrorMessage = "Password is required")]
        [MinLength(6, ErrorMessage = "Password must be at least 6 characters")]
        public string? Password { get; set; }
    }

    public async Task HandleRegister()
    {
        try
        {
            _isLoading = true;
            _errorMessage = null;
            
            await Task.Delay(1200);

            if (_registerModel.Username != "admin" || _registerModel.Email != "admin@example.com" || _registerModel.Password != "123456")
            {
                _errorMessage = "Invalid login credentials";
                return;
            }
            NavigationManager.NavigateTo("/");
        }
        catch (Exception)
        {
            _errorMessage = "An unexcepted error occurred during login.";
        }
        finally
        {
            _isLoading = false;
        }
    }

    [Inject] private NavigationManager NavigationManager { get; set; } = null!;
}